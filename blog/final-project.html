<!doctype html>
<html style="font-size: 16px;"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <meta name="keywords" content="Post 1 Headline">
    <meta name="description" content="">
    <meta name="page_type" content="np-template-header-footer-from-plugin">
    <title>Final Project</title>
    <link rel="stylesheet" href="../nicepage.css" media="screen">
<link rel="stylesheet" href="../Post-Template.css" media="screen">
    <script class="u-script" type="text/javascript" src="../jquery.js" defer=""></script>
    <script class="u-script" type="text/javascript" src="../nicepage.js" defer=""></script>
    <meta name="generator" content="Nicepage 3.18.0, nicepage.com">
    <link id="u-theme-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i">
    
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script type="application/ld+json">{
		"@context": "http://schema.org",
		"@type": "Organization",
		"name": "Site1",
		"logo": "images/gearfab.png"
}</script>
    <meta name="theme-color" content="#478ac9">
    <meta property="og:title" content="Post Template">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
  </head>
  <body class="u-body"><header class="u-clearfix u-header u-header" id="sec-ec76"><div class="u-clearfix u-sheet u-sheet-1">
        <a href="../Home.html" data-page-id="14159105" class="u-image u-logo u-image-1" data-image-width="512" data-image-height="510" title="Home">
          <img src="../images/gearfab.png" class="u-logo-image u-logo-image-1" data-image-width="64">
        </a>
        <nav class="u-menu u-menu-dropdown u-offcanvas u-menu-1">
          <div class="menu-collapse" style="font-size: 1rem; letter-spacing: 0px;">
            <a class="u-button-style u-custom-left-right-menu-spacing u-custom-padding-bottom u-custom-top-bottom-menu-spacing u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base" href="#">
              <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#menu-hamburger"></use></svg>
              <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><symbol id="menu-hamburger" viewBox="0 0 16 16" style="width: 16px; height: 16px;"><rect y="1" width="16" height="2"></rect><rect y="7" width="16" height="2"></rect><rect y="13" width="16" height="2"></rect>
</symbol>
</defs></svg>
            </a>
          </div>
          <div class="u-custom-menu u-nav-container">
            <ul class="u-nav u-unstyled u-nav-1"><li class="u-nav-item"><a class="u-button-style u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base" href="../Home.html" style="padding: 10px 20px;">Main</a><div class="u-nav-popup"><ul class="u-h-spacing-20 u-nav u-unstyled u-v-spacing-10 u-nav-2"><li class="u-nav-item"><a class="u-button-style u-nav-link u-white" href="../About.html">About Me</a>
</li></ul>
</div>
</li></ul>
          </div>
          <div class="u-custom-menu u-nav-container-collapse">
            <div class="u-black u-container-style u-inner-container-layout u-opacity u-opacity-95 u-sidenav">
              <div class="u-sidenav-overflow">
                <div class="u-menu-close"></div>
                <ul class="u-align-center u-nav u-popupmenu-items u-unstyled u-nav-3"><li class="u-nav-item"><a class="u-button-style u-nav-link" href="../Home.html" style="padding: 10px 20px;">Main</a><div class="u-nav-popup"><ul class="u-h-spacing-20 u-nav u-unstyled u-v-spacing-10 u-nav-4"><li class="u-nav-item"><a class="u-button-style u-nav-link" href="../About.html">About Me</a>
</li></ul>
</div>
</li></ul>
              </div>
            </div>
            <div class="u-black u-menu-overlay u-opacity u-opacity-70"></div>
          </div>
        </nav>
      </div></header>
    <section class="u-align-center u-clearfix u-section-1" id="sec-b45a">
      <div class="u-clearfix u-sheet u-valign-middle-md u-valign-middle-sm u-valign-middle-xs u-sheet-1"><!--post_details--><!--post_details_options_json--><!--{"source":""}--><!--/post_details_options_json--><!--blog_post-->
        <div class="u-container-style u-expanded-width u-post-details u-post-details-1">
          <div class="u-container-layout u-valign-middle u-container-layout-1"><!--blog_post_image-->
            <img alt="" class="u-blog-control u-expanded-width u-image u-image-default u-image-1" src="../images/4e149081d18b5d0c9f2ec5b1b1b812b985ca70a95b011c27cc9af724186c751a3c81be46a94d28216b84f06a152a382a7dc137c5f27dd01671bdf1_1280.jpg"><!--/blog_post_image--><!--blog_post_header-->
            <h2 class="u-blog-control u-text u-text-1">Final Project</h2><!--/blog_post_header--><!--blog_post_metadata-->
            <div class="u-blog-control u-metadata u-metadata-1"><!--blog_post_metadata_date-->
              <span class="u-meta-date u-meta-icon">Aug 05, 2021</span><!--/blog_post_metadata_date--><!--blog_post_metadata_category-->
              <!--/blog_post_metadata_category--><!--blog_post_metadata_comments-->
              <!--/blog_post_metadata_comments-->
            </div><!--/blog_post_metadata--><!--blog_post_content-->
            <div class="u-align-justify u-blog-control u-post-content u-text u-text-2 fr-view"><p>Censor-Glass: A novel solution for IRL blocking and censorship</p><iframe width="560" height="315" src="https://www.youtube.com/embed/UHWoxV3-t4c" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe><hr><p><span style="font-weight: 700;">A Revolutionary Concept</span></p><p>For the longest time, we've enjoyed a level of censorship like no other in the realm of the online world. These days, you can block nearly anybody on anything, and prevent yourself or other from seeing problematic content. However, unfortunately this luxury does not extend into the real world, where you have no choice but to endure people and content you don't want to see.&nbsp;</p><p>But not anymore - with Censor-Glass you can finally block out anything you want in the real world. This can be especially useful if you have a grudge or distaste for a particular person, or have specific content that you don't want to be exposed to. In the future, this device could actually create haar cascades of nearly anything you dislike (from people and words, to specific foods or artists) and block that out from your vision. The idea of blocking people in real life is also prominently featured in Black Mirror, and this project is in a sense also an hommage to the show.</p><hr><p><span style="font-weight: 700;">How it Works&nbsp;</span></p><p>The Censor-Glass is based around a 3D printed frame in the form of glasses, which holds a USB camera on the side and transparent OLED display in front of the eyes. The USB display connects directly to my computer where it provides video feed for a python script running OpenCV, a library for advanced computer vision. The python script uses haar cascades to identify the object of interest in the field of view, and outputs the coordinates of its location and size. This information is then sent over to an arduino microcontroller over Serial communication, and the arduino creates a dark square over the location of the object, blocking it from view.</p><hr><p><span style="font-weight: 700;">Hardware</span></p><p><span style="font-style: italic;">Circuitry</span></p><p>- <a class="u-active-none u-border-none u-btn u-button-style u-hover-none u-none u-text-palette-1-base u-block-c012-5" href="https://www.adafruit.com/product/3505" style="background-image: none; padding-top: 0; padding-bottom: 0; padding-left: 0; padding-right: 0">Adafruit Metro M0 Express</a></p><p>- <a class="u-active-none u-border-none u-btn u-button-style u-hover-none u-none u-text-palette-1-base u-block-c012-6" href="https://www.amazon.com/gp/product/B01DRG250Q/ref=ppx_yo_dt_b_asin_title_o08_s00?ie=UTF8&amp;psc=1" style="background-image: none; padding-top: 0; padding-bottom: 0; padding-left: 0; padding-right: 0">ELP VGA Mini USB Camera Module (100 degree lens)</a></p><p>- <a class="u-active-none u-border-none u-btn u-button-style u-hover-none u-none u-text-palette-1-base u-block-c012-7" href="https://www.amazon.com/gp/product/B01DRG250Q/ref=ppx_yo_dt_b_asin_title_o08_s00?ie=UTF8&amp;psc=1" style="background-image: none; padding-top: 0; padding-bottom: 0; padding-left: 0; padding-right: 0">Sparkfun Transparent Graphical OLED I2C</a></p><p>- My Computer :)</p><p><span style="font-style: italic;">3D Prints</span></p><p>For the frame of the glasses I used <a class="u-active-none u-border-none u-btn u-button-style u-hover-none u-none u-text-palette-1-base u-block-c012-8" href="https://www.thingiverse.com/thing:2801880" style="background-image: none; padding-top: 0; padding-bottom: 0; padding-left: 0; padding-right: 0">this design</a> from online, which I imported into Solidworks and added features to in order to fit all the hardware. Link to <a class="u-active-none u-border-none u-btn u-button-style u-hover-none u-none u-text-palette-1-base u-block-c012-9" href="https://drive.google.com/file/d/1aLAdnaQmBEqhr0H-EF4hC4gP4YcjPJo9/view?usp=sharing" style="background-image: none; padding-top: 0; padding-bottom: 0; padding-left: 0; padding-right: 0">STL file here</a>. Below is also a misprint - the library I had do the print for me had a lot of issues with the print for some reason, but luckily they were eventually able to get it to workusing dissolvable supports.&nbsp;</p><p><img src="../images/Screenshot183.png" width="650" style="width: 418px;" class="fr-dib fr-fic"></p><p><img src="../images/IMG_20210801_094723.jpg" width="650" style="width: 290px;" class="fr-dib fr-fic"></p><p><img src="../images/IMG_20210801_100246.jpg" width="650" style="width: 282px;" class="fr-dib fr-fic"></p><hr><p><span style="font-weight: 700;">Software</span></p><p>The software was certainly the trickiest part of this project. Luckily, I had a decent amount of experience with OpenCV before so it didn't take me too long to get it working.&nbsp;</p><p><span style="font-style: italic;">Object Recognition and Camera Correction</span></p><p>Object recognition in OpenCV is fairly straight forward - it uses something called Haar Cascades which is a file that includes a collection of patterns found in the object you're trying to detect. You can either download an existing cascade file from online or create your own - in this case I played around with both.&nbsp;</p><p>The more difficult part was adjusting the curvature of the camera. The one I used was a wide-angle 100 degree lens, so the image was scewed on the edges, which is problematic for mapping positions from camera to OLED display. To solve this, I used the fisheye undistort function, as you can see in the code below. The code also shows the K and D constants used for undistorting the image (these values are unique for each lens). There is a built in function to find those coefficience but I couldn't get it to work so I just guess-and-checked my way to decent constants. Below you can also see a checkerboard pattern before and after the distortion filter.</p><pre><code class="python">DIM=(640, 480)
K = np.array([[400.40629437753046, 0.0, 300.829270787], [0.0, 400.00780962876536, 300.9546102473427], [0.0, 0.0, 1.0]])
D=np.array([-0.01515303912651211, 0.09148012072176424, -0.2080496385404225, 0.13211726263924817])


def undistort(img_path):
    img = img_path
    h,w = img.shape[:2]
    map1, map2 = cv2.fisheye.initUndistortRectifyMap(K, D, np.eye(3), K, DIM, cv2.CV_16SC2)
    undistorted_img = cv2.remap(img, map1, map2, interpolation=cv2.INTER_LINEAR, borderMode=cv2.BORDER_CONSTANT)
    return undistorted_img</code></pre><p><img src="../images/Screenshot250.png" width="537" style="width: 385px;" class="fr-dii fr-fic fr-fir"><img src="../images/Screenshot251.png" width="517" style="width: 375px;" class="fr-dib fr-fic fr-fir"></p><p>For the actual object recognition, I used the built in haar cascade identifier, which outputs rectangles around all the identified objects. I then mapped it onto the dimensions of the OLED display and added a "squish factor" to account for the scale conversion between the two. Code for the final coordinates sent to the arduino via serial is shown below.</p><pre><code class="python">imgx = undistort(img)
    
    gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
    faces = face_cascade.detectMultiScale(gray, 1.3, 5)
    

    for (x,y,w,h) in faces:
        cv2.rectangle(imgx,(x,y),(x+w,y+h),(255,0,0),2)

        squish_x = 0.7
        squish_y = 1
        x1 = ((x/len(imgx[0]))*squish_x) + (1-squish_x)/2
        y1 = ((y/len(imgx[1]))*squish_y) + (1-squish_y)/2
        w1 = (w/len(imgx[0]))
        h1 = (h/len(imgx[1]))

        oled_x = 128-1
        oled_y = 32-1

        my_x = int(oled_x*x1) 
        my_y = int(oled_y*(y1+h1))
        my_w = int(oled_x*w1)
        my_h = int(2*oled_y*h1)
              
        msg =  str(my_x)+","+str(my_y)+","+str(my_w)+","+str(my_h)+","
        print(msg)
        ser.write(msg.encode())
        time.sleep(0.1)
        
        
        roi_gray = gray[y:y+h, x:x+w]
        roi_color = imgx[y:y+h, x:x+w]</code></pre><p><span style="font-style: italic;">Serial Communication</span></p><p>Below is the code for the serial communication on the side of the arduino, and above you can see the concatenated string produced and send by the python script. The arduino simply parses between commas, and converts those values to integers that it uses as variables for the rectangle dimensions.</p><pre><code class="arduino.js">void loop(void) {
  int temp[4] = {0,0,0,0}; 
  int i = 0;
  while (Serial.available() > 0) {
    // reads string up to comma, then adds to array
    String t = Serial.readStringUntil(',');
    temp[i] = t.toInt();
    i++;
  }
  if (temp[0] != 0 or temp[1] != 0 or temp[2] != 0 or temp[3] != 0){
    // creates box with dimensions collected from serial
    temp[1] = 28-temp[1];
    u8g2.clearBuffer();          // clear the internal memory
    u8g2.drawBox(temp[0],temp[1],temp[2],temp[3]);  // u8g2.drawBox (x, y, w, h)
    u8g2.drawBox(temp[0],temp[1]+32,temp[2],temp[3]);
    
    u8g2.sendBuffer();          // transfer internal memory to the display
  }
  delay(200);  
}</code></pre><p><span style="font-style: italic;">OLED Display (uh oh...)</span></p><p>The OLED display turned out to be much harder to get to work than I originally expected. After following the suggested libraries, I found that the display refused to turn on, no matter which microcontroller I used. After deep diving, I found out the library (and really any graphics processing) requires an immense amount of processing power, which the Metro or Uno's 32kb memory just can't handle. Without a stronger processor at hand, I had to defer to using buffering, which involves saving the image you want projected to buffered memory, and then deploying it via I2C - basically batching the processing power. The drawback of this is much more latency and lag, as you can see in the demo video. The final code for the drawings is shown above and is fairly simple, just using the drawBox function of the u8g2 graphics library.</p><hr><p><span style="font-weight: 700;">Future Work</span></p><p>I genuinely think the Censor-Glass could one day find success as a consumer product, or at the very least a successful kickstart campaign. If properly designed, the use cases would be endless. I think it could also function as a great exposition piece to start a discussion about censorship, and make us consider the power of censorship of groups in power as well as censorship on an individual level, especially in the active online scene. I have strong conviction that if something like this was actually launched on kickstarter it would hit the cover on the New York Times in no time.</p></div><!--/blog_post_content-->
          </div>
        </div><!--/blog_post--><!--/post_details-->
      </div>
    </section>
    
    
    <footer class="u-align-center u-clearfix u-footer u-grey-80 u-footer" id="sec-3dea"><div class="u-align-left u-clearfix u-sheet u-sheet-1"></div></footer>
  
</body></html>